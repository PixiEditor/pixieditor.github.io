<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-core-guide">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">PixiEditor&#x27;s Core | PixiEditor</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pixieditor.net/img/PixiEditorBanner.png"><meta data-rh="true" name="twitter:image" content="https://pixieditor.net/img/PixiEditorBanner.png"><meta data-rh="true" property="og:url" content="https://pixieditor.net/docs/core-guide"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="theme-color" content="#2c2c2c"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="PixiEditor&#x27;s Core | PixiEditor"><meta data-rh="true" name="description" content="ChangeableDocument"><meta data-rh="true" property="og:description" content="ChangeableDocument"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pixieditor.net/docs/core-guide"><link data-rh="true" rel="alternate" href="https://pixieditor.net/docs/core-guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://pixieditor.net/docs/core-guide" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="PixiEditor RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="PixiEditor Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-XLN6FQ07LW","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XLN6FQ07LW"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XLN6FQ07LW",{anonymize_ip:!0})</script>


<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async data-ad-client="ca-pub-8372287848779618"></script>
<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8372287848779618" async crossorigin="anonymous"></script><link rel="stylesheet" href="/assets/css/styles.5b192be5.css">
<link rel="preload" href="/assets/js/runtime~main.0eb350b2.js" as="script">
<link rel="preload" href="/assets/js/main.e281d0f0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon-96x96.png" alt="PixiEditor Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon-96x96.png" alt="PixiEditor Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">PixiEditor</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/help">Help</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/colorpicker">Color Picker</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" id="download-nav" href="/download">Download</a><a href="https://github.com/PixiEditor/PixiEditor" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://opencollective.com/pixieditor" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Donate ✨<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction">Getting Started 🏠</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/shortcuts">Usage 🎮</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/start-here">Contributing 💻</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/start-here">Start here</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/codebase-overview">Codebase overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/ui-guide">PixiEditor&#x27;s GUI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/core-guide">PixiEditor&#x27;s Core</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/change-walkthrough">How the pen tool works</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/toolbars">ToolViewModels</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/color-picker">Color Picker 🎨</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/faq">Other 🔍</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Contributing 💻</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PixiEditor&#x27;s Core</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>PixiEditor&#x27;s Core</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changeabledocument">ChangeableDocument<a href="#changeabledocument" class="hash-link" aria-label="Direct link to ChangeableDocument" title="Direct link to ChangeableDocument">​</a></h2><p>ChangeableDocument is a system used to keep track of all changes done to a document.
The system is implemented in the <code>ChangeableDocument</code> project and it is the main part of PixiEditor that enables undo and redo functionality.</p><p>The <code>Document</code> class stores most of the data of a single document. This includes document dimensions, all layers with their bitmaps, blend modes,
all folders, selection, reference layer, and other stuff. The data can be freely read from the UI, but the only way to write into it
is by using the change pipeline implemented in the <code>DocumentChangeTracker</code> class.</p><p><code>DocumentChangeTracker</code> class implements a pipeline which accepts <code>IAction</code> instances, modifies the <code>Document</code> based on them,
and returns <code>IChangeInfo</code> instances. <code>IAction</code> instances describe user&#x27;s actions. For example, <code>ResizeCanvas_Action</code> is created
and passed down the pipeline when the user resizes the canvas. It contains the new canvas size.
After accepting the <code>ResizeCanvas_Action</code> <code>DocumentChangeTracker</code> creates a new instances of the change that corresponds to it, in this case <code>ResizeCanvas_Change</code>.</p><p>The GUI passes actions to <code>DocumentChangeTracker</code> from the <code>ActionAccumulator</code> class.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="changes">Changes<a href="#changes" class="hash-link" aria-label="Direct link to Changes" title="Direct link to Changes">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="regular-change">Regular Change<a href="#regular-change" class="hash-link" aria-label="Direct link to Regular Change" title="Direct link to Regular Change">​</a></h4><p>The &quot;change&quot; is an object that describes some modification made to the
document, like changing it&#x27;s size. Changes have two main methods: <code>Apply</code> and <code>Revert</code>, used for applying and reverting the change.
These methods directly write into the contents of the <code>Document</code> class.</p><p>If we take changing document size as an example, <code>Apply</code> method applies the change, in this case,
it resizes the document to the new requested size, cropping the layer bitmaps. <code>Revert</code> goes the other way:
it restores the original size of the canvas, resizes the layer bitmaps back to the original size, and draws the areas on the edges that
were previously cut away. All data required to apply and revert the change is saved inside the change itself.</p><p><code>Apply</code> and <code>Revert</code> functions return zero, one, or multiple instances of <code>IChangeInfo</code>. Each instance of <code>IChangeInfo</code>
concretely describes a change made to one or multiple properties of <code>Document</code>, for example &quot;Document size property changed from 64x64
to 128x128&quot;. These ChangeInfos are passed to the UI, and they are utilized to update the state of the UI.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="updateablechange">UpdateableChange<a href="#updateablechange" class="hash-link" aria-label="Direct link to UpdateableChange" title="Direct link to UpdateableChange">​</a></h4><p>Some changes can&#x27;t be applied right away. Let&#x27;s take using a lasso tool to select an area as an example. When using
a lasso tool, you first hold down left mouse button, then select the area, then release the button, and only then the
final area is known. This means that the lasso change needs to get updates continiously while you are selecting.</p><p>This is what <code>UpdateableChange</code> is for. It has an <code>ApplyTemporarily</code> function that accepts updated data and returns
<code>IChangeInfo</code>&#x27;s. <code>ApplyTemporarily</code> is very similar to <code>Apply</code>, but it can be called multiple times while you are selecting
the area, and once you are done <code>Apply</code> is still called. If an updateable change gets reverted and then re-applied
<code>ApplyTemporarily</code> is not called.</p><p><code>UpdateableChange</code>&#x27;s have two corresponding <code>IAction</code>&#x27;s: the first one implements <code>IStartUpdateChangeAction</code>
and is used to start and update the change; the second one implements <code>IEndChangeAction</code> and it indicates the end of
the change.</p><p>Here is an example of how you&#x27;d use actions to execute updateable changes. This example changes layer/folder opacity,
like you would while dragging the opacity slider.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// user started dragging the slider, start changing opacity of layer/folder with guid memberGuid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// initial value - 1.0f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// this will create an updateable change and call it&#x27;s `ApplyTemporarily`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Helpers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ActionAccumulator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">AddActions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">StructureMemberOpacity_Action</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">memberGuid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">1.0f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token range operator">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// some time later, user dragged the slider to 0.5, update opacity to 0.5f</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// this will call `ApplyTemporarily` of the active updateable change</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Helpers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ActionAccumulator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">AddActions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">StructureMemberOpacity_Action</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">memberGuid</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0.5f</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token range operator">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// some time later, when the user let go of the slider, end the change</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// this calls `Apply` of the active updateable change</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Helpers</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">ActionAccumulator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">AddFinishedActions</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">EndStructureMemberOpacity_Action</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="layerimagechunks_changeinfo">LayerImageChunks_ChangeInfo<a href="#layerimagechunks_changeinfo" class="hash-link" aria-label="Direct link to LayerImageChunks_ChangeInfo" title="Direct link to LayerImageChunks_ChangeInfo">​</a></h4><p>Whenever something is drawn on one of the layer bitmaps, the GUI needs to know what area was updated.
ChangeableDocument uses <code>LayerImageChunks_ChangeInfo</code> to pass the updated areas to the GUI.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chunkyimage">ChunkyImage<a href="#chunkyimage" class="hash-link" aria-label="Direct link to ChunkyImage" title="Direct link to ChunkyImage">​</a></h2><p><code>ChunkyImageLib</code> provides a bitmap class. <code>ChunkyImage</code>&#x27;s are used to store the contents of a layer and it&#x27;s mask.
You can draw on <code>ChunkyImage</code> by calling methods that enqueue various drawing operations. </p><p>The drawing operations can be cancelled, allowing you to preview the changes before committing them.
For example, cancelling is used when transforming an area of the canvas, since the app needs to display the transformed image
while it is being moved around. On every position change the old image drawing operation is cancelled,
and a new one is enqueued in the new position. Other examples include drawing shapes, using brushes, and in general to
anything that requires continious input from the user with immediate visual feedback.</p><p>Inside <code>ChunkyImage</code>, the image is stored as a set of 256x256 segments, or chunks. The drawing operations are applied individually and
independently to each chunk. They are applied in a lazy fashion, chunks are updated to the latest version only if you
try to access them. Moreover, there is an option to render chunks in low resolution. All of this enables PixiEditor to
display the above mentioned &quot;continuous&quot; operations in a very efficient way: parts of the image not currently on display
aren&#x27;t being rendered, and if you zoom far enough the rendering system switches to using a low resolution.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-changeabledocument-uses-chunkyimages">How ChangeableDocument uses ChunkyImages<a href="#how-changeabledocument-uses-chunkyimages" class="hash-link" aria-label="Direct link to How ChangeableDocument uses ChunkyImages" title="Direct link to How ChangeableDocument uses ChunkyImages">​</a></h2><p>In general, we draw on <code>ChunkyImage</code>s from various <code>Change</code>s and <code>UpdateableChange</code>s. As an example, let&#x27;s take the <code>Apply</code>
function of <code>ReplaceColor_Change</code>. <code>ReplaceColor_Change</code> operates on all layers, replacing one color with another, e.g.
all red #FF0000 pixels are replaced by green #00FF00 pixels.</p><div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">override</span><span class="token plain"> </span><span class="token return-type class-name">OneOf</span><span class="token return-type class-name punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token return-type class-name">None</span><span class="token return-type class-name punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token return-type class-name"> IChangeInfo</span><span class="token return-type class-name punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token return-type class-name"> List</span><span class="token return-type class-name punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token return-type class-name">IChangeInfo</span><span class="token return-type class-name punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token return-type class-name punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">Apply</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Document</span><span class="token plain"> target</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> firstApply</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">out</span><span class="token plain"> </span><span class="token class-name keyword" style="color:rgb(189, 147, 249);font-style:italic">bool</span><span class="token plain"> ignoreInUndo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token range operator">..</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// initialize a dictionary where old versions of the chunks will be stored</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// they are needed cause the change can get reverted in the future</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    savedChunks </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token class-name">List</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token class-name">IChangeInfo</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"> infos </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// for each layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    target</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">ForEveryMember</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">member </span><span class="token operator">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">member </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">is</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token class-name">Layer</span><span class="token plain"> layer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// enqueue a color replacing operation in layer&#x27;s ChunkyImage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        layer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LayerImage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">EnqueueReplaceColor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">oldColor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> newColor</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// find all chunks affected by currently enqueued operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token class-name">HashSet</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token class-name">VecI</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token class-name punctuation" style="color:rgb(248, 248, 242)">?</span><span class="token plain"> chunks </span><span class="token operator">=</span><span class="token plain"> layer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LayerImage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">FindAffectedChunks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// save these chunks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token class-name">CommittedChunkStorage</span><span class="token plain"> storage </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">layer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LayerImage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> chunks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        savedChunks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">layer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">GuidValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> storage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// fully commit changes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        layer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">LayerImage</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">CommitChanges</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// create a new changeinfo for this layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        infos</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Add</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">new</span><span class="token plain"> </span><span class="token constructor-invocation class-name">LayerImageChunks_ChangeInfo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">layer</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">GuidValue</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> chunks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// if no layers were modified, don&#x27;t save this change in the undo/redo history</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ignoreInUndo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">savedChunks</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Any</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// return all created infos</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> infos</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice how we first enqueue changes in ChunkyImage, then get affected chunks, save them in <code>CommittedChunkStorage</code>,
then commit them. This is a very common pattern, shared by many changes. <code>ApplyTemporarily</code> functions of
<code>UpdateableChange</code>s usually don&#x27;t commit the changes, as they may need to be cancelled on the next update (next
call to <code>ApplyTemporarily</code>). Instead the changes are committed in the <code>Apply</code> function.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/ui-guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">PixiEditor&#x27;s GUI</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/change-walkthrough"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How the pen tool works</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#changeabledocument" class="table-of-contents__link toc-highlight">ChangeableDocument</a><ul><li><a href="#changes" class="table-of-contents__link toc-highlight">Changes</a></li></ul></li><li><a href="#chunkyimage" class="table-of-contents__link toc-highlight">ChunkyImage</a></li><li><a href="#how-changeabledocument-uses-chunkyimages" class="table-of-contents__link toc-highlight">How ChangeableDocument uses ChunkyImages</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/Introduction">Getting started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.reddit.com/r/PixiEditor/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/PixiEditor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/qSRMYmq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCT5XvyvX1q5PAIaXfWmpsMQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://instagram.com/pixi.editor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opencollective.com/pixieditor" target="_blank" rel="noopener noreferrer" class="footer__link-item">Donate<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/privacy-policy">Privacy Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/"><img src="/img/favicon-96x96.png" alt="PixiEditor Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/favicon-96x96.png" alt="PixiEditor Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2023 PixiEditor Organization</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0eb350b2.js"></script>
<script src="/assets/js/main.e281d0f0.js"></script>
</body>
</html>